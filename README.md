# **RuseLoRaWAN**
**Този проект е собственост на "Starup Factory - Ruse"**

#### **1. Описание**
- Този пример е подходящ за хора, които знаят какво е TTN. В случай, че не се чувствате уверени в това, мола посетете следната стрница: [**Документация**](https://www.thethingsnetwork.org/docs/)
- Това е само пример как да използвате Adafruit Feather 32u4 RFM95 в мрежата на TTN. Ето и повече информация за самото устройство, което ще свържем към TTN: [**Документация**](https://learn.adafruit.com/adafruit-feather-32u4-radio-with-lora-radio-module)

#### **2. Приготовление**
 - За да използваме LoRa/RFM95 възможностите на това устройство е необходимо да свържете ~6 и IO1:

| Feather  | RFM95  |
| ----------- |:-------:|
| ~6          | IO1      |

_Таблица 1_

![](https://ttnstaticfile.blob.core.windows.net/media/django-summernote/2017-08-08/b132cae3-4101-4b65-94bf-06598e4177fc.png)

_Фигура 1_


 - Свържете проводник с дължина 82.1 mm, този размер е 1/4 от дължината на вълната при честота 868MHz. Която е позволената LoRa четотна лента за Европа. Калкулацията за сверяване на вашите входни данни, може да извършите със следния онлайн [**Калкулатор**](https://learn.adafruit.com/adafruit-feather-32u4-radio-with-lora-radio-module) . В този случай ще използваме само вртикално поляризираният излъчващ елемент. Виж фиг. 1.

| Параметър | Мерна Единица | Стойност |
|-----------|-----------|:-------:|
|Честота|MHz|868|
|Скорост на разпространение||0,95|
|Дължина на вълната|mm|345,6|
|(A)Вертикално поляризиран излъчващ елемент (λ*0,25)*vf|mm|82,1|
|(B)Радилани ребра (λ*0,28)*vf|mm|91,9|

_Таблица 2_

![](https://m0ukd.com/static/calculators/Quarter_Wave_Ground_Plane/Quarter_Wave_Drawing.png)

_Фигура 2_

#### **3. Приготовление на средата**
 - Ако сте се запознали с устройството и неговата документация описани в точка 1 "Описание", то следващата [**Стъпка**](https://learn.adafruit.com/adafruit-feather-32u4-radio-with-lora-radio-module/using-with-arduino-ide) няма да представлява трудност за вас. В тази стъпка настройваме средата за работа с устройството.
 - След като сме инсталирали всичко необходимо, за да програмиране нашето устройство следва да добавим библиотеката [**LMIC**](https://github.com/matthijskooijman/arduino-lmic) за работа с LoRa стека. Добавянето става, като изтеглим архив от връзката и го разархивираме в C:\Users\ "ВашиятПотребител"\Documents\Arduino\libraries\lmic. След като сте я разархивирали е редно да рестартирате Arduino приложението, за да може средата да възприеме новата библиотека.
 - За да може следващата библиотека да работи е необходимо да инсталираме една основна. Добавянето става, като изтеглим [**Aрхив от връзката**](https://github.com/bencpeters/node-adafruit-sensor) и го разархивираме в C:\Users\ “ВашиятПотребител”\Documents\Arduino\libraries\Adafruit_Sensor-master. След като сте я разархивирали е редно да рестартирате Arduino приложението, за да може средата да възприеме новата библиотека. 
 - Поради особенности на проекта е решено да се използва BMP280 сензор за примерни измервания, в тази под-точка ще дадем указания как се инсталира тази библиотека. Добавянето става, като изтеглим [**Aрхив от връзката**](https://github.com/adafruit/Adafruit_BMP280_Library) и го разархивираме в C:\Users\ “ВашиятПотребител”\Documents\Arduino\libraries\Adafruit_BMP280_Library. След като сте я разархивирали е редно да рестартирате Arduino приложението, за да може средата да възприеме новата библиотека.
 - След инсталирането на библиотеките за работа с LoRa/TTN и BM280 идва ред на библиотека, която отговаря за пакетирането на информацията от сензорите. Библиотеката се казва CayenneLPP. Ето и [**Връзка към документцацията**](https://www.thethingsnetwork.org/docs/devices/arduino/api/cayennelpp.html). Добавянето става, като изтеглим [**Aрхив от връзката**](https://github.com/sabas1080/CayenneLPP) и го разархивираме в C:\Users\ “ВашиятПотребител”\Documents\Arduino\libraries\CayenneLPP. След като сте я разархивирали е редно да рестартирате Arduino приложението, за да може средата да възприеме новата библиотека.
 - В случай, че има смели хора, в нашият списък със задачи от точка 6, малко по-надулу в този документ има задача, която е свързана с дълбоко приспиване на устройството. Един от вариантите за решаването ѝ е свързано с [**Тази библиотека**](https://github.com/adafruit/Adafruit_SleepyDog).  Добавянето става, като изтеглим [**Aрхив от връзката**](https://github.com/adafruit/Adafruit_SleepyDog) и го разархивираме в C:\Users\ “ВашиятПотребител”\Documents\Arduino\libraries\Adafruit_SleepyDog_Library. След като сте я разархивирали е редно да рестартирате Arduino приложението, за да може средата да възприеме новата библиотека.
 
#### **4. Програмиране на Adafruit Feather**
 - Програмирането на устройството е лесно, като да програмираш обикновенно Ардуино. Който се е запознал документацията описана в точка 1 "Описание" за него няма тайни. 
 - Първото най-важно нещо е да настроим правилно вашата среда - От менюто "Tools" -> "Board" -> Избираме Adafruit Feather 32u4.
 - След като сме избрали модела на своето устройстово е необходимо да изберем комуникационият порт на устройството - От менюто "Tools" -> "Port" -> COMx (Adafruit Feather 32u4).
 - Следва да сте свързани с вашето устройство.
 - Моля натиснете Verifie и се убедете, че всичко се компилира коректно.
 - Ако е коректно, е ред да сложите в кода си вашите уникални ключове за сесията, приложението и номера на вашето устройство.
 - След добавянена тези ключове устройството, Ви, е готово за работа и следващи модификации.

#### **5. Проби**
 - Пробите се извършват след предварително работещ LoRa Gate.
#### **6. Задачи**
 - 1. Да се приспива устройството за 15 минути и на всяко събуждане да изпраща по едно измерване.
